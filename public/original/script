for file in *.jpg; do convert "$file" -alpha set -background none -channel RGBA -fill '#00000000' -fuzz 5% -draw 'matte 1,1 floodfill' int1.png; convert -fuzz 100% -fill '#3bc444' -opaque '#000000' int1.png int2.png; convert -spread 10 int2.png int3.png; composite -geometry +0+0 int1.png int3.png int4.png; convert -geometry 268x342 int4.png int5.png; composite int5.png photo_bg_big.png int6.png; composite -geometry +40+38 int6.png alphaimage.png int7.png; composite -geometry +0+0 photo_frame.png int7.png "${file%.*}.png"; done